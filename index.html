<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pablo's Blog</title>
    <style>
        body { font-family: -apple-system, sans-serif; max-width: 750px; margin: 0 auto; padding: 40px 20px; line-height: 1.6; }
        header { border-bottom: 3px solid #000; margin-bottom: 40px; cursor: pointer; }
        article { margin-bottom: 60px; }
        img { max-width: 100%; border-radius: 12px; margin: 20px 0; display: block; }
        .content { white-space: pre-wrap; font-size: 1.1rem; }

        /* THE GHOST ADMIN */
        #ghost-studio { 
            display: none; position: fixed; inset: 0; background: #fff; z-index: 9999;
            flex-direction: column; padding: 20px;
        }
        .admin-active #ghost-studio { display: flex; }
        
        .toolbar { display: flex; gap: 10px; padding: 10px; background: #eee; overflow-x: auto; border-radius: 8px; }
        .editor-container { flex: 1; display: flex; flex-direction: column; margin-top: 20px; border: 1px solid #ddd; border-radius: 12px; overflow: hidden; }
        #visual-view { flex: 1; padding: 20px; outline: none; overflow-y: auto; min-height: 300px; }
        #code-view { flex: 1; padding: 20px; background: #1a1a1a; color: #0f0; border: none; font-family: monospace; display: none; }
        
        .save-btn { background: #000; color: #fff; padding: 20px; border: none; font-weight: bold; font-size: 1.2rem; cursor: pointer; }
    </style>
</head>
<body>

    <header onclick="tryUnlock()">
        <h1>Pablo's Blog</h1>
    </header>

    <div id="blog-display">Loading...</div>

    <div id="ghost-studio">
        <div class="toolbar">
            <input type="password" id="gh-token" placeholder="GitHub Token">
            <button onclick="document.execCommand('bold')">B</button>
            <button onclick="toggleMode()">View Code</button>
            <input type="color" onchange="document.execCommand('foreColor', false, this.value)">
            <button onclick="location.reload()" style="margin-left:auto; color:red;">Close</button>
        </div>
        <div class="editor-container">
            <input type="text" id="post-title" placeholder="Post Title" style="width:100%; padding:20px; font-size:1.5rem; border:none; border-bottom:1px solid #eee; outline:none;">
            <div id="visual-view" contenteditable="true"></div>
            <textarea id="code-view"></textarea>
        </div>
        <button class="save-btn" onclick="publish()">SAVE & PUBLISH</button>
    </div>

    <script>
        const G_USER = 'pablovolenski';
        const G_REPO = 'my-blog';
        
        // This is the SHA-256 hash for the password "pablo"
        // No one can reverse-engineer this to find your password.
        const SECRET_HASH = "8671607f23c9006e88d01b173663a75f80f97063d83893a74a23e51408018e6e";

        // 1. Password Protection Logic
        async function tryUnlock() {
            const pass = prompt("Enter Secret Key:");
            if (!pass) return;

            // Simple SHA-256 Hashing in JS
            const msgUint8 = new TextEncoder().encode(pass);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

            if (hashHex === SECRET_HASH) {
                document.body.classList.add('admin-active');
            } else {
                alert("Incorrect key.");
            }
        }

        // 2. Load Content
        async function loadBlog() {
            try {
                const res = await fetch('posts.json?t=' + Date.now());
                const posts = await res.json();
                const container = document.getElementById('blog-display');
                container.innerHTML = posts.map(p => `
                    <article>
                        <h2>${p.title}</h2>
                        <span style="color:#999; font-size:0.8rem;">${p.date}</span>
                        <div class="content">${p.content}</div>
                    </article>
                `).join('');
            } catch (e) { console.log("First post needed."); }
        }

        // 3. Editor Switching
        function toggleMode() {
            const v = document.getElementById('visual-view');
            const c = document.getElementById('code-view');
            if (v.style.display === 'none') {
                v.innerHTML = c.value;
                v.style.display = 'block'; c.style.display = 'none';
            } else {
                c.value = v.innerHTML;
                v.style.display = 'none'; c.style.display = 'block';
            }
        }

        // 4. Publishing
        async function publish() {
            const token = document.getElementById('gh-token').value;
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('visual-view').innerHTML;
            if(!token || !title) return alert("Token & Title required.");

            const res = await fetch(`https://api.github.com/repos/${G_USER}/${G_REPO}/contents/posts.json`);
            const data = await res.json();
            let posts = JSON.parse(atob(data.content));
            
            posts.unshift({ title, content, date: new Date().toDateString() });

            const update = await fetch(`https://api.github.com/repos/${G_USER}/${G_REPO}/contents/posts.json`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}` },
                body: JSON.stringify({
                    message: "Ghost Update",
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(posts, null, 2)))),
                    sha: data.sha
                })
            });
            if(update.ok) location.reload();
        }

        loadBlog();
    </script>
</body>
</html>
